
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Developer notes &#8212; pypal 0+untagged.210.gc6bd515.dirty documentation</title>

  <link rel="stylesheet" href="_static/css/index.d431a4ee1c1efae0e38bdfebc22debff.css">


  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">



  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">


    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />

  <link rel="preload" as="script" href="_static/js/index.30270b6e4c972e43c488.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="The PyPAL API reference" href="api.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">

    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">


    <a class="navbar-brand" href="index.html">
      <img src="_static/pypal_logo.png" class="logo" alt="logo">
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">


        <li class="nav-item ">
            <a class="nav-link" href="getting_started.html">Getting Started</a>
        </li>

        <li class="nav-item ">
            <a class="nav-link" href="tutorials.html">Tutorials</a>
        </li>

        <li class="nav-item ">
            <a class="nav-link" href="background.html">Background</a>
        </li>

        <li class="nav-item ">
            <a class="nav-link" href="api.html">The PyPAL API reference</a>
        </li>

        <li class="nav-item active">
            <a class="nav-link" href="">Developer notes</a>
        </li>


      </ul>




      <ul class="navbar-nav">

          <li class="nav-item">
            <a class="nav-link" href="https://github.com/kjappelbaum/pypal" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>


      </ul>
    </div>
</div>
    </nav>


    <div class="container-xl">
      <div class="row">

          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">


  <ul class="nav bd-sidenav">













    </ul>

</nav>
          </div>



          <div class="d-none d-xl-block col-xl-2 bd-toc">

<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">

        <li class="nav-item toc-entry toc-h2">
            <a href="#contribution-guidelines" class="nav-link">Contribution Guidelines</a><ul class="nav section-nav flex-column">

        <li class="nav-item toc-entry toc-h3">
            <a href="#commit-messages" class="nav-link">Commit messages</a>
        </li>

        <li class="nav-item toc-entry toc-h3">
            <a href="#python-code" class="nav-link">Python code</a>
        </li>

        <li class="nav-item toc-entry toc-h3">
            <a href="#new-features" class="nav-link">New features</a>
        </li>

        <li class="nav-item toc-entry toc-h3">
            <a href="#documentation" class="nav-link">Documentation</a>
        </li>

            </ul>
        </li>

        <li class="nav-item toc-entry toc-h2">
            <a href="#implementing-a-new-pal-class" class="nav-link">Implementing a new PAL class</a>
        </li>

    </ul>
</nav>



          </div>



          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">

              <div>

  <div class="section" id="developer-notes">
<h1>Developer notes<a class="headerlink" href="#developer-notes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="contribution-guidelines">
<h2>Contribution Guidelines<a class="headerlink" href="#contribution-guidelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="commit-messages">
<h3>Commit messages<a class="headerlink" href="#commit-messages" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>To automatically generate the changelog and version numbers we use <a class="reference external" href="https://www.conventionalcommits.org/en/v1.0.0-beta.2/">conventional commits</a> use the prefix <code class="code docutils literal notranslate"><span class="pre">feat</span></code> for new features, <code class="code docutils literal notranslate"><span class="pre">chore</span></code> <a class="reference external" href="https://stackoverflow.com/questions/26944762/when-to-use-chore-as-type-of-commit-message">for updating grunt tasks etc; no production code change</a>, <code class="code docutils literal notranslate"><span class="pre">fix</span></code> for bug fixes and <code class="code docutils literal notranslate"><span class="pre">docs</span></code> for changes to the documentation.</p></li>
</ul>
</div>
<div class="section" id="python-code">
<h3>Python code<a class="headerlink" href="#python-code" title="Permalink to this headline">¶</a></h3>
<p>Please install the pre-commit hooks using</p>
<p>to automatically</p>
<ul class="simple">
<li><p>format the code with <a class="reference external" href="https://github.com/psf/black">black</a></p></li>
<li><p>sort the imports with <a class="reference external" href="https://pycqa.github.io/isort/">isort</a></p></li>
<li><p>lint the code with <a class="reference external" href="http://prospector.landscape.io/en/master/">prospector</a></p></li>
</ul>
<p>We use type hints, which we feel is a good way of documentation and helps us find bugs using <a class="reference external" href="http://mypy-lang.org/">mypy</a>.</p>
<p>Some of the pre-commit hooks modify the files, e.g., they trim whitespaces or format the code. If they modify your file, you will have
to run <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> and <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> again. To skip the pre-commit checks (not recommended) you can use <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">--no-verify</span></code>.</p>
</div>
<div class="section" id="new-features">
<h3>New features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h3>
<p>Please make a new branch for the development of new features. <a class="reference external" href="https://medium.com/&#64;ruthmpardee/git-fork-workflow-using-rebase-587a144be470">Rebase on the upstream master</a> and include a test for your new feature. (The CI checks for a drop in code coverage.)</p>
</div>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>Currently, documentation is hosted on GitHub pages. Build it locally using <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> in the <code class="code docutils literal notranslate"><span class="pre">doc</span></code> directory and then push it to GitHub pages using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git subtree push --prefix docs/_build/html  origin gh-pages
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-a-new-pal-class">
<h2>Implementing a new PAL class<a class="headerlink" href="#implementing-a-new-pal-class" title="Permalink to this headline">¶</a></h2>
<p>If you want to use PyPAL  with a model that we do not support yet, i.e., not <code class="code docutils literal notranslate"><span class="pre">GPy</span></code> or <code class="code docutils literal notranslate"><span class="pre">sklearn</span></code> Gaussian process regression, it is easy to write your own class. For this, you need to inherit from <cite>PALBase</cite> and implement your  <code class="code docutils literal notranslate"><span class="pre">_train</span></code> and <code class="code docutils literal notranslate"><span class="pre">_predict</span></code> functions (and maybe also the <code class="code docutils literal notranslate"><span class="pre">_set_hyperparameters</span></code> and <code class="code docutils literal notranslate"><span class="pre">_should_optimize_hyperparameters</span></code> functions) using the <code class="code docutils literal notranslate"><span class="pre">design_space</span></code> and <code class="code docutils literal notranslate"><span class="pre">y</span></code> attributes of the class.</p>
<p>For instance, if we develop some multioutput model that has a <code class="code docutils literal notranslate"><span class="pre">train()</span></code> and a <code class="code docutils literal notranslate"><span class="pre">predict()</span></code> method we could simply use the following design pattern</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pypal</span> <span class="kn">import</span> <span class="n">PALBase</span>

<span class="k">class</span> <span class="nc">PALMyModel</span><span class="p">(</span><span class="n">PALBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">design_space</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampled</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampled</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">design_space</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we typically provide the models, even if it is only one, in a list to keep the API consistent.</p>
<p>In some instances, you might want to perform an operation in parallel, e.g., train the models for different objectives in parallel. One convenient way to do this in Python is <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html">concurrent.futures</a>. The only hitch is that this approach requires that the function is picklable. To ensure is, you may want to implement the function that is to be run in parallel outside the class. For example, you could use the following design pattern</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pypal</span> <span class="kn">import</span> <span class="n">PALBase</span>
<span class="kn">import</span> <span class="nn">concurrent.futures</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">_train_model_picklable</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">design_space</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">sampled</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">design_space</span><span class="p">[</span><span class="n">sampled</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]],</span>
        <span class="n">objectives</span><span class="p">[</span><span class="n">sampled</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">class</span> <span class="nc">MyPal</span><span class="p">(</span><span class="n">PALBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;n_jobs&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">validate_njobs</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">validate_number_models</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">train_single_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">_train_model_picklable</span><span class="p">,</span>
            <span class="n">models</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">,</span>
            <span class="n">design_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">design_space</span><span class="p">,</span>
            <span class="n">objectives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">sampled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampled</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">train_single_partial</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)):</span>
                <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">models</span>
</pre></div>
</div>
</div>
</div>


              </div>


              <div class='prev-next-bottom'>

    <a class='left-prev' id="prev-link" href="api.html" title="previous page">The PyPAL API reference</a>

              </div>

          </main>


      </div>
    </div>


  <script src="_static/js/index.30270b6e4c972e43c488.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Kevin Maik Jablonka, Brian Yoo, Berend Smit.<br/>
    </p>
  </div>
</footer>
  </body>
</html>
